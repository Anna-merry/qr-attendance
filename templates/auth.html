<!-- templates/auth.html -->
{% extends "base.html" %}

{% block title %}{{ 'Регистрация' if mode == 'register' else 'Вход' }} — QR-Сканер{% endblock %}

{% block header_content %}
<div class="nav-buttons">
    <a href="{{ url_for('home') }}" class="btn btn-secondary">Назад</a>
</div>
{% endblock %}

{% block content %}


    <div class="auth-container">
        <!-- Вкладки остаются, но теперь они — ссылки на разные URL -->
        <div class="auth-tabs">
            <a href="{{ url_for('login') }}" class="auth-tab {% if mode == 'login' %}active{% else %}inactive{% endif %}">Вход</a>
            <a href="{{ url_for('register') }}" class="auth-tab {% if mode == 'register' %}active{% else %}inactive{% endif %}">Регистрация</a>
        </div>

        <form method="POST" class="auth-form">
            
            <div class="form-group">
                <label class="form-label">Кто вы?</label>
                <div class="select-wrapper">
                    <select name="role" id="user-role" onchange="toggleGroupField()">
                        <option value="student" {% if request.form.role == 'student' or (mode == 'register' and not request.form) %}selected{% endif %}>Студент</option>
                        <option value="teacher" {% if request.form.role == 'teacher' %}selected{% endif %}>Преподаватель</option>
                    </select>
                </div>
            </div>

            <div class="form-group" id="group-field" style="display: none;">
    <label class="form-label">Группа</label>
    <select name="group" class="form-select" required>
        <option value="">— Выберите группу —</option>
        <option value="Д-Э 307" {% if request.form.group == 'Д-Э 307' %}selected{% endif %}>Д-Э 307</option>
        <option value="Д-Э 309" {% if request.form.group == 'Д-Э 309' %}selected{% endif %}>Д-Э 309</option>
        <option value="Д-Э 310" {% if request.form.group == 'Д-Э 310' %}selected{% endif %}>Д-Э 310</option>
        <option value="Д-Э 342" {% if request.form.group == 'Д-Э 342' %}selected{% endif %}>Д-Э 342</option>
        <option value="Д-Э 317" {% if request.form.group == 'Д-Э 317' %}selected{% endif %}>Д-Э 317</option>
        <option value="Д-Э 341" {% if request.form.group == 'Д-Э 341' %}selected{% endif %}>Д-Э 341</option>
        <option value="Д-Э 312" {% if request.form.group == 'Д-Э 312' %}selected{% endif %}>Д-Э 312</option>
        <option value="Д-Э 315" {% if request.form.group == 'Д-Э 315' %}selected{% endif %}>Д-Э 315</option>
        <option value="Д-Э 318" {% if request.form.group == 'Д-Э 318' %}selected{% endif %}>Д-Э 318</option>
        <option value="Д-Э 316" {% if request.form.group == 'Д-Э 316' %}selected{% endif %}>Д-Э 316</option>
        <option value="Д-Э 343" {% if request.form.group == 'Д-Э 343' %}selected{% endif %}>Д-Э 343</option>
        <option value="Д-Э 301" {% if request.form.group == 'Д-Э 301' %}selected{% endif %}>Д-Э 301</option>
    </select>
</div>

            <div class="form-group">
                <label class="form-label">Имя и фамилия</label>
                <input type="text" name="username"  class="form-input" value="{{ request.form.fullname or '' }}" placeholder="Введите ваше имя и фамилию" required>
            </div>

            <div class="form-group">
                <label class="form-label">Пароль</label>
                <input type="password" name="password" class="form-input" placeholder="Введите пароль" required>
            </div>

            <button type="submit" class="submit-btn">
                {% if mode == 'register' %}Зарегистрироваться{% else %}Войти{% endif %}
            </button>
        </form>

        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="success-message" style="display:block; margin-top: 20px;">
                    {% for msg in messages %}
                        {{ msg }}
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
    </div>
</div>

<script>
function toggleGroupField() {
    const role = document.getElementById('user-role').value;
    const groupField = document.getElementById('group-field');
    const groupSelect = groupField.querySelector('select[name="group"]'); // ← изменили имя переменной
    
    if (role === 'student') {
        groupField.style.display = 'block';
        groupSelect.setAttribute('required', 'required');
    } else {
        groupField.style.display = 'none';
        groupSelect.removeAttribute('required');
    }
}
document.addEventListener('DOMContentLoaded', function() {
    const roleSelect = document.getElementById('user-role');
    const initialRole = '{{ request.form.role or "student" }}';
    roleSelect.value = initialRole;
    toggleGroupField();
});

document.getElementById('user-role')?.addEventListener('change', toggleGroupField);
</script>
{% endblock %}